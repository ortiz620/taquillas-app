# Requiere: Python + Flask
# Puedes usar esto directamente en Replit.com con la plantilla 'Flask'

from flask import Flask, render_template_string, request, redirect, url_for
from datetime import datetime

app = Flask(__name__)

taquillas = []  # Lista para almacenar las taquillas
cortes = {}     # Diccionario para almacenar cortes diarios
gastos = {}     # Diccionario para almacenar gastos diarios

# HTML con estilos personalizados y logo
html = '''
<!DOCTYPE html>
<html>
<head>
    <title>Calculadora de Taquillas</title>
    <style>
        body {
            background-color: #0C2C55;
            color: white;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        h1, h2, h3 {
            color: #FFA500;
        }
        input[type="text"], input[type="number"] {
            margin: 5px;
            padding: 5px;
        }
        input[type="submit"] {
            padding: 5px 10px;
            background-color: #FF4C00;
            color: white;
            border: none;
            cursor: pointer;
        }
        .taquilla {
            background-color: #143D6B;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <img src="https://storage.googleapis.com/prompt-images-static-public/atracciones-tijuana-logo.png" alt="Logo Atracciones Tijuana" width="200">
    <h1>Calculadora de Ventas por Taquilla</h1>

    <h2>Agregar nueva taquilla</h2>
    <form method="post" action="/agregar">
        Nombre: <input type="text" name="nombre" required><br>
        Precio por boleto: <input type="number" step="0.01" name="precio" required><br>
        <input type="submit" value="Agregar Taquilla">
    </form>

    <hr>

    <h2>Taquillas registradas</h2>
    {% for t in taquillas %}
        <div class="taquilla">
            <form method="post" action="/calcular/{{ loop.index0 }}">
                <h3>{{ t['nombre'] }} (Precio: ${{ t['precio'] }})</h3>
                Boleto inicial: <input type="number" name="inicial" required>
                Boleto final: <input type="number" name="final" required>
                <input type="submit" value="Calcular Venta">
            </form>
            {% if t['resultado'] is not none %}
                <p><strong>Total de venta:</strong> ${{ t['resultado'] }}</p>
            {% endif %}
        </div>
    {% endfor %}

    <h2>Agregar gasto del día</h2>
    <form method="post" action="/agregar_gasto">
        Descripción del gasto: <input type="text" name="descripcion" required>
        Monto: <input type="number" step="0.01" name="monto" required>
        <input type="submit" value="Agregar Gasto">
    </form>

    <hr>

    <h2>Cortes de caja por día</h2>
    {% for dia in cortes.keys() %}
        <p>
            <strong>{{ dia }}</strong><br>
            Ingreso bruto: ${{ cortes[dia] }}<br>
            Gasto bruto: ${{ gastos.get(dia, 0.0) }}<br>
            Ingreso neto: ${{ cortes[dia] - gastos.get(dia, 0.0) }}
        </p>
    {% endfor %}

    <h3>Total general: ${{ total_general }}</h3>
</body>
</html>
'''

@app.route('/')
def index():
    total_general = sum(cortes.get(d, 0) - gastos.get(d, 0) for d in cortes)
    return render_template_string(html, taquillas=taquillas, cortes=cortes, gastos=gastos, total_general=round(total_general, 2))

@app.route('/agregar', methods=['POST'])
def agregar():
    nombre = request.form['nombre']
    precio = float(request.form['precio'])
    taquillas.append({
        'nombre': nombre,
        'precio': precio,
        'resultado': None
    })
    return redirect(url_for('index'))

@app.route('/calcular/<int:index>', methods=['POST'])
def calcular(index):
    inicial = int(request.form['inicial'])
    final = int(request.form['final'])
    boletos_vendidos = final - inicial - 2
    if boletos_vendidos < 0:
        boletos_vendidos = 0
    resultado = boletos_vendidos * taquillas[index]['precio']
    taquillas[index]['resultado'] = round(resultado, 2)

    hoy = datetime.now().strftime('%Y-%m-%d')
    if hoy not in cortes:
        cortes[hoy] = 0
    cortes[hoy] += taquillas[index]['resultado']

    return redirect(url_for('index'))

@app.route('/agregar_gasto', methods=['POST'])
def agregar_gasto():
    descripcion = request.form['descripcion']
    monto = float(request.form['monto'])
    hoy = datetime.now().strftime('%Y-%m-%d')
    if hoy not in gastos:
        gastos[hoy] = 0.0
    gastos[hoy] += monto
    return redirect(url_for('index'))

if __name__ == '__main__':
    app.run(debug=True)
